name: Build Ubuntu Kernel
on: [push]
jobs:
  build:
    runs-on: ubuntu-24.04
    steps:
      - name: Set kernel version
        id: kernel_version
        run: |
          sudo apt update
          sudo apt install parallel -y
          sudo apt list '?name(linux-image-[[:digit:]]+.[[:digit:]]+.[[:digit:]]+-[[:digit:]]+-generic)' | awk -F' ' '{print $2}' | tail -n1 | parallel -j1 echo "TAG=Ubuntu-{}" >> "$GITHUB_OUTPUT"
      - name: Checkout kernel
        env:
          TAG: ${{ steps.kernel_version.outputs.TAG }}
        uses: actions/checkout@v4
        with:
          repository: git://git.launchpad.net/~ubuntu-kernel/ubuntu/+source/linux/+git/noble
          ref: refs/tags/${{ env.TAG }}
